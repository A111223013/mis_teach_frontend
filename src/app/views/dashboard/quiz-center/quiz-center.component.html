<div class="quiz-center-container p-4">
  <c-card>
    <c-card-header class="bg-primary text-white">
      <h3 class="mb-0">
        <c-icon name="cilNotes" class="me-2"></c-icon>
        測驗中心
      </h3>
    </c-card-header>
    <c-card-body>
      <div class="mb-4">
        <div class="btn-group w-100 mb-4">
          <button 
            class="btn"
            [class.btn-primary]="activeTab === 'knowledge'"
            [class.btn-outline-primary]="activeTab !== 'knowledge'"
            (click)="activeTab = 'knowledge'">
            知識點測驗
          </button>
          <button 
            class="btn"
            [class.btn-primary]="activeTab === 'pastexam'"
            [class.btn-outline-primary]="activeTab !== 'pastexam'"
            (click)="activeTab = 'pastexam'">
            學校考古題測驗
          </button>
        </div>
        
        <!-- 知識點測驗 -->
        <div *ngIf="activeTab === 'knowledge'">
          <div class="p-3">
            <h5 class="mb-3">知識點測驗</h5>
            <p class="text-muted mb-4">
              根據特定知識點進行測驗，鞏固理解並查找知識漏洞
            </p>
            
            <c-card class="mb-4 border-info">
              <c-card-body>
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="mb-0">選擇知識點</h6>
                </div>
                
                <div class="d-flex flex-wrap gap-2 mb-3">
                  <button 
                    *ngFor="let subject of availableSubjects" 
                    class="btn btn-outline-primary" 
                    [class.active]="selectedTopic === subject"
                    (click)="selectedTopic = subject">
                    {{ subject }} 
                    <c-badge *ngIf="selectedTopic === subject" color="primary" shape="rounded-pill" class="ms-2">
                      已選 ({{ getSubjectCount(subject) }}題)
                    </c-badge>
                  </button>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="mb-0">選擇難度</h6>
                </div>
                
                <div class="d-flex align-items-center gap-2 mb-4">
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="difficulty" id="easy" value="easy" [(ngModel)]="selectedDifficulty">
                    <label class="form-check-label" for="easy">簡單</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="difficulty" id="medium" value="medium" [(ngModel)]="selectedDifficulty">
                    <label class="form-check-label" for="medium">中等</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="difficulty" id="hard" value="hard" [(ngModel)]="selectedDifficulty">
                    <label class="form-check-label" for="hard">困難</label>
                  </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="mb-0">題目數量</h6>
                </div>
                
                <div class="d-flex align-items-center gap-2 mb-4">
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="questionCount" id="ten" value="10" [(ngModel)]="questionCount">
                    <label class="form-check-label" for="ten">10題</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="questionCount" id="twenty" value="20" [(ngModel)]="questionCount">
                    <label class="form-check-label" for="twenty">20題</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="questionCount" id="thirty" value="30" [(ngModel)]="questionCount">
                    <label class="form-check-label" for="thirty">30題</label>
                  </div>
                </div>
                
                <div class="d-grid">
                  <button class="btn btn-primary btn-lg" (click)="startKnowledgeQuiz()" [disabled]="!selectedTopic || !selectedDifficulty || !questionCount">
                    <c-icon name="cilMediaPlay" class="me-2"></c-icon>
                    開始測驗
                  </button>
                </div>
              </c-card-body>
            </c-card>
          </div>
        </div>
        
        <!-- 學校考古題測驗 -->
        <div *ngIf="activeTab === 'pastexam'">
          <div class="p-3">
            <h5 class="mb-3">學校考古題測驗</h5>
            <p class="text-muted mb-4">
              選擇特定學校、年度和系所的考古題進行測驗
            </p>
            
            <c-card class="mb-4 border-info">
              <c-card-body>
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="mb-0">🏫 選擇學校</h6>
                </div>
                
                <div class="option-grid">
                  <div 
                    *ngFor="let school of availableSchools" 
                    class="option-card"
                    [class.selected]="selectedSchool === school"
                    (click)="selectedSchool = school; onSchoolChange()">
                    <div class="option-text">{{ school }}</div>
                  </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3" *ngIf="selectedSchool">
                  <h6 class="mb-0">📅 選擇年度</h6>
                </div>
                
                <div class="option-grid" *ngIf="selectedSchool">
                  <div 
                    *ngFor="let year of availableYears" 
                    class="option-card"
                    [class.selected]="selectedYear === year"
                    (click)="selectedYear = year; onYearChange()">
                    <div class="option-text">{{ year }}年</div>
                  </div>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-3" *ngIf="selectedSchool && selectedYear">
                  <h6 class="mb-0">🎓 選擇系所</h6>
                </div>
                
                <div class="option-grid" *ngIf="selectedSchool && selectedYear">
                  <div 
                    *ngFor="let dept of availableDepartments" 
                    class="option-card"
                    [class.selected]="selectedDepartment === dept"
                    (click)="selectedDepartment = dept; onDepartmentChange()">
                    <div class="option-text">{{ dept }}</div>
                  </div>
                </div>
                
                <div *ngIf="selectedSchool && selectedYear && selectedDepartment && actualQuestionCount > 0" class="alert alert-info mb-4">
                  <div class="d-flex align-items-center">
                    <c-icon name="cilInfo" class="me-2"></c-icon>
                    <span>找到 {{ actualQuestionCount }} 道題目</span>
                  </div>
                </div>
                
                <div *ngIf="selectedSchool && selectedYear && selectedDepartment && actualQuestionCount === 0" class="alert alert-warning mb-4">
                  <div class="d-flex align-items-center">
                    <c-icon name="cilWarning" class="me-2"></c-icon>
                    <span>該條件下沒有找到考題</span>
                  </div>
                </div>
                
                <div class="d-grid">
                  <button class="btn btn-primary btn-lg" (click)="startPastExamQuiz()" [disabled]="!selectedSchool || !selectedYear || !selectedDepartment || actualQuestionCount === 0">
                    <c-icon name="cilMediaPlay" class="me-2"></c-icon>
                    開始測驗
                  </button>
                </div>
              </c-card-body>
            </c-card>
          </div>
        </div>
      </div>
    </c-card-body>
  </c-card>
</div> 